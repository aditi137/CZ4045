I,am,currently,running,a,Flask,+,SQLAlchemy,+,uWSGI,+,nginx,stack,for,an,API,backend,that,I,am,developing,for,my,application,.,I,was,attempting,to,see,what,is,the,maximum,amount,of,concurrent,connection,I,can,have,on,my,server,by,using,ApacheBench,and,sending,different,amounts,of,concurrent,requests,to,an,endpoint,on,the,server,.,This,endpoint,would,take,a,JSON,request,body,",",extract,certain,values,",",run,a,query,",",then,return,a,JSON,response,based,on,the,results,of,the,query,.,I,ran,a,base,test,of,1,concurrent,request,for,10,requests,",",and,I,got,an,average,response,time,of,60,milliseconds,.,Running,another,test,with,10,concurrent,requests,for,100,requests,returned,an,average,of,150ms,",",100,concurrent,requests,for,1000,returned,1500ms,and,500,concurrent,requests,returned,around,7000-9000ms,.,The,latency,seems,to,be,linearly,increasing,which,makes,sense,",",but,it,seemed,to,increase,TOO,quickly,.,After,doing,a,lot,of,tinkering,and,profiling,",",I,found,that,the,bottleneck,was,the,queries,.,At,the,start,of,the,benchmark,",",the,queries,would,process,and,return,quickly,under,10-50ms,",",but,it,quickly,increased,and,in,some,cases,latencies,of,10000-15000,ms,were,being,seen,.,I,couldn't,figure,out,why,the,db,was,slowing,down,so,much,especially,since,it,is,empty,(,barring,test,data,),.,I,tried,running,the,application,WITHOUT,a,connection,pool,",",and,the,results,showed,that,latency,went,down,(,7-9s,to,5-6s,),.,I,did,not,think,this,was,possible,because,everything,I,read,suggested,having,a,connection,pool,will,always,make,things,faster,because,you,avoid,the,overhead,of,establishing,a,new,connection,every,time,you,make,a,request,.,I,also,experimented,with,INCREASING,the,connection,pool,size,(,from,the,default,5,to,50,),",",and,that,decreased,latency,even,more,than,the,pool-less,setup(5-6s to 3-4s),.,The,latency,is,still,extremely,high,(,3-4,seconds,for,an,API,seems,unreasonable,by,any,standard,),",",and,I,am,trying,to,figure,out,how,I,can,decrease,it,even,more,.,Is,the,answer,just,more,connections,?,Note,:,I,am,running,4,uWSGI,processes,with,100,threads,each,on,a,server,with,4GB,ram,and,a,quad,core,processor,.,I,am,using,the,psycopg2-cffi,adapter,for,the,connection,",",and,the,application,is,running,on,PyPy,.
