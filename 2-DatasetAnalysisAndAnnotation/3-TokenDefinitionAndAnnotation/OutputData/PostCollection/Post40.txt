A straightforward solution:
I have changed some variable names to avoid conflicts.
On large data, you may convert intervals to a set.
