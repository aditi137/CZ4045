,0
0,The
1,cleanest
2,solution
3,would
4,be
5,inotify
6,in
7,many
8,ways
9,-
10,this
11,is
12,more
13,or
14,less
15,exactly
16,what
17,it
18,'s
19,intended
20,for
21,","
22,after
23,all
24,.
25,If
26,the
27,log
28,file
29,was
30,changing
31,extremely
32,rapidly
33,then
34,you
35,could
36,potentially
37,risk
38,being
39,woken
40,up
41,almost
42,constantly
43,","
44,which
45,wouldn
46,'t
47,necessarily
48,be
49,particularly
50,efficient
51,-
52,however
53,","
54,you
55,could
56,always
57,mitigate
58,this
59,by
60,adding
61,a
62,short
63,delay
64,of
65,your
66,own
67,after
68,the
69,inotify
70,filehandle
71,returns
72,an
73,event
74,.
75,In
76,practice
77,I
78,doubt
79,this
80,would
81,be
82,an
83,issue
84,on
85,most
86,systems
87,","
88,but
89,I
90,thought
91,it
92,worth
93,mentioning
94,in
95,case
96,your
97,system
98,is
99,very
100,tight
101,on
102,CPU
103,resources
104,.
105,I
106,can
107,'t
108,see
109,how
110,the
111,sleep
112,()
113,approach
114,would
115,miss
116,file
117,updates
118,except
119,in
120,cases
121,where
122,the
123,file
124,is
125,truncated
126,or
127,rotated
128,(i.e.
129,renamed
130,and
131,another
132,file
133,of
134,the
135,same
136,name
137,created
138,).
139,These
140,are
141,tricky
142,cases
143,to
144,handle
145,however
146,you
147,do
148,things
149,","
150,and
151,you
152,can
153,use
154,tricks
155,like
156,periodically
157,re
158,-opening
159,the
160,file
161,by
162,name
163,to
164,check
165,for
166,rotation
167,.
168,Read
169,the
170,tail
171,man
172,page
173,because
174,it
175,handles
176,many
177,such
178,cases
179,","
180,and
181,they
182,'re
183,going
184,to
185,be
186,quite
187,common
188,for
189,log
190,files
191,in
192,particular
193,(log
194,rotation
195,being
196,widely
197,considered
198,to
199,be
200,good
201,practice
202,).
203,The
204,downside
205,of
206,sleep
207,()
208,is
209,of
210,course
211,that
212,you
213,'d
214,end
215,up
216,batching
217,up
218,your
219,reads
220,with
221,delays
222,in
223,between
224,","
225,and
226,also
227,that
228,you
229,have
230,the
231,overhead
232,of
233,constantly
234,waking
235,up
236,and
237,polling
238,the
239,file
240,even
241,when
242,it
243,'s
244,not
245,changing
246,.
247,If
248,you
249,did
250,this
251,","
252,say
253,","
254,once
255,per
256,second
257,","
258,however
259,","
260,the
261,overhead
262,probably
263,isn
264,'t
265,noticeable
266,on
267,most
268,systems
269,.
270,I
271,'d
272,say
273,inotify
274,is
275,the
276,best
277,choice
278,unless
279,you
280,want
281,to
282,remain
283,compatible
284,","
285,in
286,which
287,case
288,the
289,simple
290,fallback
291,using
292,sleep
293,()
294,is
295,still
296,quite
297,reasonable
298,.
299,"EDIT:
I just realised I forgot to mention - an easy way to check for a file being renamed is to perform an os.fstat(fd.fileno()"
300,)
301,on
302,your
303,open
304,filehandle
305,and
306,a
307,os
308,.stat()
309,on
310,the
311,filename
312,you
313,opened
314,and
315,compare
316,the
317,results
318,.
319,If
320,the
321,os
322,.stat()
323,fails
324,then
325,the
326,error
327,will
328,tell
329,you
330,if
331,the
332,file
333,'s
334,been
335,deleted
336,","
337,and
338,if
339,not
340,then
341,comparing
342,the
343,st_ino
344,(the
345,inode
346,number
347,)
348,fields
349,will
350,tell
351,you
352,if
353,the
354,file
355,'s
356,been
357,deleted
358,and
359,then
360,replaced
361,with
362,a
363,new
364,one
365,of
366,the
367,same
368,name
369,.
370,Detecting
371,truncation
372,is
373,harder
374,-
375,effectively
376,your
377,read
378,pointer
379,remains
380,at
381,the
382,same
383,offset
384,in
385,the
386,file
387,and
388,reading
389,will
390,return
391,nothing
392,until
393,the
394,file
395,content
396,size
397,gets
398,back
399,to
400,where
401,you
402,were
403,-
404,then
405,the
406,file
407,will
408,read
409,from
410,that
411,point
412,as
413,normal
414,.
415,If
416,you
417,call
418,os
419,.stat()
420,frequently
421,you
422,could
423,check
424,for
425,the
426,file
427,size
428,going
429,backwards
430,-
431,alternatively
432,you
433,could
434,use
435,fd
436,.tell()
437,to
438,record
439,your
440,current
441,position
442,in
443,the
444,file
445,and
446,then
447,perform
448,an
449,explicit
450,seek
451,to
452,the
453,end
454,of
455,the
456,file
457,and
458,call
459,fd
460,.tell()
461,again
462,.
463,If
464,the
465,value
466,is
467,lower
468,","
469,then
470,the
471,file
472,'s
473,been
474,truncated
475,under
476,you
477,.
478,This
479,is
480,a
481,safe
482,operation
483,as
484,long
485,as
486,you
487,keep
488,the
489,original
490,file
491,position
492,around
493,because
494,you
495,can
496,always
497,seek
498,back
499,to
500,it
501,after
502,the
503,check
504,.
505,Alternatively
506,if
507,you
508,'re
509,using
510,inotify
511,anyway
512,","
513,you
514,could
515,just
516,watch
517,the
518,parent
519,directory
520,for
521,changes
522,.
523,Note
524,that
525,files
526,can
527,be
528,truncated
529,to
530,non
531,-zero
532,sizes
533,","
534,but
535,I
536,doubt
537,that
538,'s
539,likely
540,to
541,happen
542,to
543,a
544,log
545,file
546,-
547,the
548,common
549,cases
550,will
551,be
552,being
553,deleted
554,and
555,replaced
556,","
557,or
558,truncated
559,to
560,zero
561,.
562,Also
563,","
564,I
565,don
566,'t
567,know
568,how
569,you
570,'d
571,detect
572,the
573,case
574,that
575,the
576,file
577,was
578,truncated
579,and
580,then
581,immediately
582,filled
583,back
584,up
585,to
586,beyond
587,your
588,current
589,position
590,","
591,except
592,by
593,remembering
594,the
595,most
596,recent
597,N
598,characters
599,and
600,comparing
601,them
602,","
603,but
604,that
605,'s
606,a
607,pretty
608,grotty
609,thing
610,to
611,do
612,.
613,I
614,think
615,inotify
616,will
617,just
618,tell
619,you
620,the
621,file
622,has
623,been
624,modified
625,in
626,that
627,case
628,.
