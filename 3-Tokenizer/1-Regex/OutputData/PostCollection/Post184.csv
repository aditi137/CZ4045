I,would,say,your,test,scheme,is,not,really,useful,.,To,fulfill,the,db,query,",",the,db,server,goes,through,several,steps,:,parse,the,SQL,work,up,a,query,plan,",",i,.,e,.,decide,on,which,indices,to,use,(,if,any,),",",optimize,etc.,if,an,index,is,used,",",search,it,for,the,pointers,to,the,actual,data,",",then,go,to,the,appropriate,location,in,the,data,or,if,no,index,is,used,",",scan,the,whole,table,to,determine,which,rows,are,needed,load,the,data,from,disk,into,a,temporary,location,(,hopefully,",",but,not,necessarily,",",memory,),perform,the,count(),and,avg(),calculations,So,",",creating,an,array,in,Python,and,getting,the,average,basically,skips,all,these,steps,save,the,last,one,.,As,disk,I,/,O,is,among,the,most,expensive,operations,a,program,has,to,perform,",",this,is,a,major,flaw,in,the,test,(,see,also,the,answers,to,this,question,I,asked,here,before,),.,Even,if,you,read,the,data,from,disk,in,your,other,test,",",the,process,is,completely,different,and,it's,hard,to,tell,how,relevant,the,results,are,.,To,obtain,more,information,about,where,Postgres,spends,its,time,",",I,would,suggest,the,following,tests,:,Compare,the,execution,time,of,your,query,to,a,SELECT,without,the,aggregating,functions,(,i,.,e,.,cut,step,5,),If,you,find,that,the,aggregation,leads,to,a,significant,slowdown,",",try,if,Python,does,it,faster,",",obtaining,the,raw,data,through,the,plain,SELECT,from,the,comparison,.,To,speed,up,your,query,",",reduce,disk,access,first,.,I,doubt,very,much,that,it's,the,aggregation,that,takes,the,time,.,There's,several,ways,to,do,that,:,Cache,data,(,in,memory,!,),for,subsequent,access,",",either,via,the,db,engine's,own,capabilities,or,with,tools,like,memcached,Reduce,the,size,of,your,stored,data,Optimize,the,use,of,indices,.,Sometimes,this,can,mean,to,skip,index,use,altogether,(,after,all,",",it's,disk,access,",",too,),.,For,MySQL,",",I,seem,to,remember,that,it's,recommended,to,skip,indices,if,you,assume,that,the,query,fetches,more,than,10,%,of,all,the,data,in,the,table,.,If,your,query,makes,good,use,of,indices,",",I,know,that,for,MySQL,databases,it,helps,to,put,indices,and,data,on,separate,physical,disks,.,However,",",I,don't,know,whether,that's,applicable,for,Postgres,.,There,also,might,be,more,sophisticated,problems,such,as,swapping,rows,to,disk,if,for,some,reason,the,result,set,can't,be,completely,processed,in,memory,.,But,I,would,leave,that,kind,of,research,until,I,run,into,serious,performance,problems,that,I,can't,find,another,way,to,fix,",",as,it,requires,knowledge,about,a,lot,of,little,under-the-hood,details,in,your,process,.,Update,:,I,just,realized,that,you,seem,to,have,no,use,for,indices,for,the,above,query,and,most,likely,aren't,using,any,",",too,",",so,my,advice,on,indices,probably,wasn't,helpful,.,Sorry,.,Still,",",I'd,say,that,the,aggregation,is,not,the,problem,but,disk,access,is,.,I'll,leave,the,index,stuff,in,",",anyway,",",it,might,still,have,some,use,.
