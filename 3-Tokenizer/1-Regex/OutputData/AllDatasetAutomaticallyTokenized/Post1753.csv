if
algebraic
manipulation
fails
","
you
can
go
for
a
numerical
solution
of
your
constraint
","
running
for
example
fsolve
at
each
timestep
:
Clearly
this
will
slow
down
your
time
integration
.
Always
check
that
fsolve
finds
a
good
solution
","
and
flush
the
output
so
that
you
can
realize
it
as
it
happens
and
stop
the
simulation
.
About
how
to
""""
cache
""""
the
value
of
a
variable
at
a
previous
timestep
","
you
can
exploit
the
fact
that
default
arguments
are
calculated
only
at
the
function
definition
","
Notice
that
in
order
for
the
trick
to
work
the
cache
parameter
must
be
mutable
","
and
that's
why
I
use
a
list
.
See
this
link
if
you
are
not
familiar
with
how
default
arguments
work
.
Notice
that
the
two
codes
DO
NOT
produce
the
same
result
","
and
you
should
be
very
careful
using
the
value
at
the
previous
timestep
","
both
for
numerical
stability
and
precision
.
The
second
is
clearly
much
faster
though
.
